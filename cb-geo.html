<!--
    Based on Google IO 2012/2013 HTML5 Slide Template

    Authors: Eric Bidelman <ebidel@gmail.com>
    Luke Mah√© <lukem@google.com>
    Krishna Kumar <kks32@gmx.com> added MathJax, CSS Edits, and some JS
    URL: https://code.google.com/p/io-2012-slides
  -->
<!DOCTYPE html>
<html>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script type="text/javascript"
          src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <!-- Script for Video play back on Slide for multiple videos-->
  <script
     src = "js/video.js">
  </script>

  <!-- Script for MathJax Reload to avoid race condition in Chrome -->
  <script
     src = "js/mathjax_reload.js">
  </script>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <head>
    <title></title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <!--This one seems to work all the time, but really small on ipad-->
    <!--<meta name="viewport" content="initial-scale=0.4">-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" media="all" href="theme/css/default.css">
    <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
    <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
    <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
  </head>
  <body style="opacity: 0">


<slides class="layout-widescreen">

<!-- ************************* Slide ************************************-->
<slide class="title-slide segue nobackground">
  <aside class="gdbar"><img src="images/theme/Engineering.png"></aside>
  <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
  <hgroup class="auto-fadein">
    <h1 data-config-title><!-- populated from slide_config.json --></h1>
    <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
    <p data-config-presenter><!-- populated from slide_config.json --></p><br /><br />
    <strong data-config-workshop style="color:grey; text-align:center;"> </strong><!-- popluated from slide_config.json --></h2>
	  <br /><br />
  </hgroup>
  <br /><br />
</slide>


<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>CB-Geo Software</h2>
  </hgroup>
  <br/>  
  <article id="LBM" class="smaller">
    <ul>
      <li> Lattice-Boltzmann + Discrete Element Method </li>
      <li> Finite Element Method - Thermo-Hydro Mechanical Coupling</li>
      <li> Material Point Method </li>
      <li> Lattice Element Method </li>
    </ul> 
  
    <figure>
      <img src="images/cb-geo.png" width ="100%">
      <figcaption><a href="http://www.cb-geo.com">View the CB-Geo website for 
        more information and software tools</a></figcaption>
    </figure>
  </article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LBM - DEM simulation of granular collapse in fluid</h2>
  </hgroup>
  <div class="video">
    <br />
    <video  width="100%" controls loop>
      <source src="videos/LBM_MD_A6.webm" type="video/webm">
  	Your browser does not support the video tag.
    </video>
    <br />
    <br />aspect ratio 'a' of 6 <br />
  </div>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
   <h2> Lattice Boltzmann - MRT </h2>
  </hgroup>
  <article id="LBM" class="smaller">
    <div class="left" style = "width: 48%;">
      <figure>
	<img src="images/LBMFluid.png" width ="80%">
	<figcaption style = "font-size: 80%; text-align: center; "> Real Fluid vs LBM Idealisation </figcaption>
      </figure>
    </div>

    <div class="right" style = "width: 48%;">
      <figure>
		<img src="images/D2Q9.png" width = "80%">
		<figcaption style = "font-size: 80%; text-align: center; "><br /> LBM D2Q9 Model </figcaption>
		</figure>
	</div>
	<br/>
	<div class="block" style="clear: both; width: 85%"> <!--border: solid thick grey; border-radius: 1em"-->
	 \[f_{i}(x+dx,t+\Delta t)-f_{i}(x,t)=-S_{\alpha i}(f_{i}(x,t)-f_{i}^{eq}(x,t))\]
	</div>
        <ul>
      	  <li> $S_{\alpha i}$ is the collisional matrix. </li>
      	  <li> Probability density of finding a particle: $f(x,\varepsilon,t)$, where, x is position, $\varepsilon$ is velocity, and t is time.  </li>
        </ul>
	

	<div class="left" style = "width: 48%;">
		<figure>
		<img src="images/stream.png" width = "80%">
		<figcaption style = "font-size: 80%; text-align: center; "> Streaming </figcaption>
		</figure>
	</div>

	<div class="right" style = "width: 48%;">
		<figure>
		<img src="images/collision.png" width ="80%">
		<figcaption style = "font-size: 80%; text-align: center; "> Collision </figcaption>
		</figure>
	</div>
	
	</article>
	
	<!-- Include for Chrome to Re-Jax Slides with equations -->
	<script defer> reprocessMathJax(document.getElementById('LBM'));</script>
</slide>

		
	
<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>LBM laminar & turbulent flows</h2>
	</hgroup>
	<div class = "left" style="width:50%">
		<figure>
			<img src="images/ObstacleLBM.png" width ="80%">
			<figcaption style = "font-size: 80%; text-align: center; "> <br />Lattice Boltzmann</figcaption>
		</figure>
		<br />
		<figure>
			<img src="images/ObstacleCFD.png" width ="75%">
			<figcaption style = "font-size: 80%; text-align: center; "> <br />CFD</figcaption>
		</figure>
	</div>
	<div class="right" style="width:50%;">
	  	<figure>
	  		<img src="images/Poiseuille.png" width ="80%">
	  		<figcaption style = "font-size: 80%; text-align: center; "> <br />Poiseuille Flow</figcaption>
	  	</figure>
	  	<br />
	  	<video  id="Karman" width="107%" loop>
	  		<source src="videos/Karman.webm" type="video/webm">
	  		Your browser does not support the video tag.
		</video>
		<figure><figcaption style = "font-size: 80%; text-align: center; "> <br />Karman Vortex Street </figcaption></figure>
	</div>
	    <div class="media-buttons">
      	<input type="button" id="play-button" onclick="PlayVideo('Karman')";play-button.disable=false; value="Play"/>
	</div>
</slide>

		
<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2> LBM fluid-solid coupling </h2>
	</hgroup>
	<article id="MRT" class="smaller">
    <div class="left" style = "width: 70%">
      <figure>
        <img src="images/LBM-DEM.png" width = "70%">
        <figcaption style = "font-size: 80%; text-align: center; "><br />LBM-DEM Model
        </figcaption>
      </figure>
	<div class = "block">
	  $$\Delta t_{s}=\frac{\Delta t}{\mathit{n}_{s}} \qquad (\mathit{n}_{s}=[\Delta t/ \Delta t_{D}]+1) $$
	</div>
 	<ul>
		<li>At every fluid iteration, $\mathit{n}_{s}$ 
		sub-steps of DEM iterations are performed using the time step $\Delta t_{s}$. </li>
		<li>The hydrodynamic force is unchanged during the sub-cycling. </li>
	</ul>
    </div>
    <div class ="right" style = "width=30%">
      <video id="Kissing" width="60%" controls loop>
        <source src="videos/Kissing.webm" type="video/webm">
          Your browser does not support the video tag.
      </video>
    </div>
  </article>
  <!-- Include for Chrome to Re-Jax Slides with equations -->
  <script defer> reprocessMathJax(document.getElementById('MRT'));</script>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LBM-DEM implementation</h2>
  </hgroup>
  <article id="MRT" class="smaller">
    <div style="float: left; width: 45%;">
      <ul>
        <li>C-99 code</li>
        <li>C++03 version</li>
        <li>OpenACC GPU version 2.0</li>
        <li>Visualisation VTK</li>
        <li>2D LBM-DEM Code</li>
        <ul>
          <li>D2Q9 model for fluid</li>
          <li>Pressure and velocity boundaries</li>
          <li>Periodic boundary condition</li>
          <li>Multi-Relaxation Time for numerical stability</li>
          <li>Turbulence</li>
          <li>2D discs</li>
        </ul>
	<li>Voronoi Tesselation in 2D/3d</li>
	<li>Cumulative $\beta$ distribution</li>
      </ul>
    </div>
    <div style="float: right; width: 55%;">
      <img src="images/GPU_Concept.png" width ="100%">
    </div>
</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LBM-DEM Multi-GPU implementation</h2>
  </hgroup>
  <br/>  
  <article class="smaller" style="text-align:center;">
    <figure>
      <img src="images/multi-gpu.png" width ="90%">
    </figure>
  </article>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LBM-DEM GPU implementation</h2>
  </hgroup>
  <br/>  
    <pre>
    <code class="cpp">
      // Assign to each OpenMP a different GPU
      int n_gpus = acc_get_num_devices( acc_device_nvidia );
      if( n_gpus )
        acc_set_device_num( tid % n_gpus, acc_device_nvidia );
      else 
        acc_set_device_type( acc_device_host );

      #pragma acc parallel copyout(                   \
        fhf1[0 : nbgrains],                           \
          fhf2[0 : nbgrains], fhf3[0 : nbgrains])     \
              copyin(obst[0 :][0 :], g[0 : nbgrains], \
                                      ey[0 :], f[0 :][0 :][0 :], ex[0 :])
                                      ey[0 :], f[0: ][y_start : y_end][0 :], ex[0 :])
    </code></pre>  
</slide>


<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>Collapse down inclined planes: a = 6</h2>
  </hgroup>
  <div class="video">
    <br/>
    <video  width="100%" controls loop>
      <source src="videos/LBM_DEM_A6_S5.webm" type="video/webm">
        Your browser does not support the video tag.
    </video>
    <br/>
    <ul>
      <li> LBM Nodes = 9 Million
      :   DEM grains = 5000 discs </li>
      <li> Real-time = 5 seconds </li>
      <li> Run-time = 12 hours </li>
      <li> Speedup = 125x on a GE-Force GTX 580</li>
  </div>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LBM DEM current developments / future plans</h2>
  </hgroup>
  <article id="MRT" class="smaller">
      <ul>
        <li>Generic templatised C++11/14 code</li>
	<li>Live rendering of VTK using GPUs (inprogress)</li>
  	<li>Multi-GPU support across nodes</li>
	<li>LBM:</li>
	<ul>
          <li>3D LBM model</li>
          <li>3D LB - DEM coupling</li>
	</ul>
	<li>DEM:</li>
	<ul>
          <li>3D DEM Code support for different shapes - Done (University of Grenoble)</li>
	  <li>DEM simulations on GPU</li>
	  <li>Contact models for DEM</li>
	  <li>Special boundaries for DEM</li>
	</ul>
     </ul>
    </div>
</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Material Point Method</h2>
	</hgroup>
	<article class="smaller">
	  <div class="figure" >
	    <figure>
	      <img src="images/MPM_Soil.png" width="100%">
	      <figcaption style = "font-size: 80%; text-align: center; ">
		Porosity in MPM </figcaption>
	    </figure>
	  </div>
	</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Material Point Method - Algorithm</h2>
	</hgroup>
	<article class="smaller">
	<div class="left" style="width:47%;">
	  <figure>
	  <img src="images/FlowChart.png" style="width:80%">
	  </figure>
	</div>	
	<div class="right" style="width:50%;">
	  <figure>
	  <img src="images/MPM.png" width="100%">
	  </figure>
	</div>
	</article>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Granular Slope subjected to Impact</h2>
		<h3>MPM Simulation</h3>
	</hgroup>
	<article class="smaller">
	  <div class="video">
	    <video  width="100%" controls loop>
	      <source src="videos/MPM_100J.webm" type="video/webm">
  		Your browser does not support the video tag.
	    </video>
	    <br />
	    Slope subjected to 100J of Impact Energy
	  </div>
	</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>FEM / MPM implementation</h2>
  </hgroup>
  <article id="MRT" class="smaller">
    <div style="float: left; width: 45%;">
      <ul>
        <li>Generic templatised C++11/14 code</li>
        <li>2D/3D MPM Code</li>
	<li>Generalise Interpolation Material Point</li>
        <li>Shared memory / thread parallelisation</li>
        <li>BLAS matrix algebra</li>
        <li>Visualisation VTK</li>
        <li>Material models:</li>
	<ul>
          <li>Linear elastic</li>
          <li>Mohr coulomb</li>
          <li>Bingham fluid</li>
          <li>Cam Clay</li>
          <li>NorSand</li>
        </ul>
	<li>Elements: Quadrilateral and Hexahedron</li>
      </ul>
    </div>
    <div style="float: right; width: 55%;">
      <img src="images/MPMsteps.png" width ="100%">
    </div>
</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>C++ Factory implementation</h2>
  </hgroup>
  <br/>  
    <pre>
    <code class="cpp">
	class MyElementFactory { // The factory - implements singleton pattern!
	 public:
	  static MyElementFactory* Instance(); 	  // Get the single instance of the factory
	  void RegisterFactoryFunction(
	      std::string name, std::function<Element*(void)> classFactoryFunction);
	  // create an instance of a registered class
	  std::shared_ptr<Element> Create(std::string name);
	};
	template <class T> // A helper class to register a factory function
	class Registrar {
	 public:
	  Registrar(std::string className) {
	    MyElementFactory::Instance()->RegisterFactoryFunction(
		className, [](void) -> Element * { return new T(); });
	  }
	};
    </code></pre>  
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>C++ Factory implementation</h2>
  </hgroup>
  <br/>  
    <pre>
    <code class="cpp">
	void MyElementFactory::RegisterFactoryFunction(
 	  std::string name, std::function<Element*(void)> classFactoryFunction) {
	  // register the class factory function
  	  factoryFunctionRegistry[name] = classFactoryFunction;
	}
	std::shared_ptr<Element> MyElementFactory::Create(std::string name) {
	  Element* instance = nullptr;
	  // find name in the registry and call factory method.
	  auto it = factoryFunctionRegistry.find(name);
	  if (it != factoryFunctionRegistry.end()) instance = it->second();
	  // wrap instance in a shared ptr and return
	  if (instance != nullptr)
	    return std::shared_ptr<Element>(instance);
	  else
	    return nullptr;
	}
    </code></pre>  
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>FEM / MPM Current development</h2>
  </hgroup>
  <article id="MRT" class="smaller">
    <div style="float: left; width: 45%;">
      <ul>
        <li>FE Base library</li>
	<ul>
          <li>Mesh class</li>
          <li>Solver class</li>
          <li>Assembler class</li>
          <li>MPI parallelisation</li>
	  <li>PETSc matrix algebra / solver</li>
        </ul>
	<li>FE THM coupling</li>
	<li>HDF5 support</li>
        <li>NoSQL db to store / retireve results</li>
	<li>GMSH meshing</li>
	<li>JSON input</li>
	<li>Two-phase and Two-point formulation</li>
      </ul>
    </div>
    <div style="float: right; width: 55%;">
      <img src="images/thm.png" width ="80%">
    </div>
</article>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Lattice Element Method</h2>
	</hgroup>
	<article class="smaller">
	<div class="left" style="width:47%;">
	  <figure>
	  <img src="images/lem.png" style="width:80%">
	  </figure>
	</div>	
	<div class="right" style="width:50%;">
	  <figure>
	  <img src="images/voro.png" width="100%">
	  </figure>
	</div>
	</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Lattice Element Method - Fluid coupling</h2>
	</hgroup>
	<article class="smaller">
	<div class="left" style="width:47%;">
	  <figure>
	  <img src="images/pipe-network.png" style="width:80%">
	  </figure>
	</div>	
	<div class="right" style="width:50%;">
	  <ul>
	    <li>First assume injection pressure $P_{in}$ and injection rate $Q_{in}$ at injection point</li>
      <li>Solve fluid pressure at each fluid node</li>
      <li>Convert pressure to node force and solve LEM to update fracture aperture</li>
      <li>Repeat the above process until convergence</li>
	  </ul>
		<div class="block" style="clear: both; width: 85%"> <!--border: solid thick grey; border-radius: 1em"-->
	   $$q = - \frac{h^3}{12\mu}\frac{dp}{dx}$$
  	</div>
  </div>
	</article>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Lattice Element Method - Algorithm</h2>
	</hgroup>
	<article class="smaller" style="text-align:center">
	  <figure>
	    <img src="images/lem-algorithm.png" style="width:60%">
	  </figure>
	</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
	<hgroup>
		<h2>Lattice Element Method</h2>
	</hgroup>
	<article class="smaller">
	  <div class="left" style="width:47%;">
      <video  width="100%" controls loop>
        <source src="videos/150000_fracture.webm" type="video/webm">
      	Your browser does not support the video tag.
      </video>
	  <br/>
	  Dry fracture
	  </div>	
	  <div class="right" style="width:50%;">
      <video  width="100%" controls loop>
        <source src="videos/lem.webm" type="video/webm">
  	    Your browser does not support the video tag.
      </video>
	    <br/>
	    Hydraulic fracturing
	  </div>
	</article>
</slide>

<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LEM implementation</h2>
  </hgroup>
  <article id="lem" class="smaller">
    <div style="float: left; width: 45%;">
      <ul>
        <li>GMSH mesh generation</li>
        <li>Generic templatised C++11/14</li>
        <li>MPI Parallelisation for large problems</li>
        <li>PETSc for multi-node solver</li>
        <li>MAGMA/cuBLAS for GPU solver</li>
	<li>LEM: </li>	
	<ul>
          <li>Linear spring elements</li>
          <li>Shear spring</li>
          <li>Simple fluid model</li>
          <li>Leak-off</li>
	</ul>
	<li>DB resume support</li>
	<li>Visulisation using VTK</li>
     </ul>
   </div>
 </article>
</slide>


<!-- ************************* Slide ************************************-->
<slide>
  <hgroup>
    <h2>LEM future developments</h2>
  </hgroup>
  <article id="lem" class="smaller">
    <div style="float: left; width: 45%;">
      <ul>
        <li>Modelling initial ground condition</li>
	<ul>
          <li>Model major faults</li>
          <li>Stratum from geological interpretation</li>
	  <li>Advanced lattice models</li>
        </ul>
	<li>Fluid model: </li>	
	<ul>
          <li>Advanced fluid models</li>
          <li>multi-stage and multi-well simulation</li>
	</ul>
        <li>Re-meshing / upscaling techniquee for multi-scale modelling</li>
        <li>Multi-node multi-GPU parallelisation for large problems</li>
	<li>Improved solution algorithm (iterative)</li>
     </ul>
   </div>
 </article>
</slide>
  
<!-- ************************* Slide ************************************-->
<slide hidden>
    Hidden slides are left out of the presentation.
</slide>


<!-- ************************* Slide ************************************-->
<slide class="thank-you-slide segue nobackground">
  <aside class="gdbar right"><img src="images/theme/Engineering.png"></aside>
  <article class="flexbox vleft auto-fadein">

    <h2>Thank You!</h2>
    <br />
    <h3>http://www.cb-geo.com</h3>
  </article>

  <p class="auto-fadein" data-config-contact>
    <!-- populated from slide_config.json -->
  </p>
  <!-- Very special thanks to Chitra -->
</slide>


<slide class="backdrop"></slide>

</slides>
<script type="text/javascript" src="js/slides.js"></script>
<script>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>
